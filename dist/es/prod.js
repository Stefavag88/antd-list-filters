import"antd/lib/card/style";import _Card from"antd/lib/card";import"antd/lib/popover/style";import _Popover from"antd/lib/popover";import"antd/lib/tooltip/style";import _Tooltip from"antd/lib/tooltip";import"antd/lib/icon/style";import _Icon from"antd/lib/icon";import"antd/lib/drawer/style";import _Drawer from"antd/lib/drawer";import"antd/lib/button/style";import _Button from"antd/lib/button";import"antd/lib/checkbox/style";import _Checkbox from"antd/lib/checkbox";import React from"react";import PropTypes from"prop-types";import fnsFormatDate from"date-fns/format";import fnsParseDate from"date-fns/parse";import fnsIsAfter from"date-fns/is_after";import fnsIsEqual from"date-fns/is_equal";import fnsIsWithinRange from"date-fns/is_within_range";import fnsIsBefore from"date-fns/is_before";import{Parser}from"expr-eval";import"antd/lib/input/style";import _Input from"antd/lib/input";import"antd/lib/select/style";import _Select from"antd/lib/select";import"antd/lib/input-number/style";import _InputNumber from"antd/lib/input-number";import"antd/lib/date-picker/style";import _DatePicker from"antd/lib/date-picker";import fnsIsValid from"date-fns/is_valid";import"antd/lib/auto-complete/style";import _AutoComplete from"antd/lib/auto-complete";function asyncGeneratorStep(e,t,r,n,a,i,l){try{var o=e[i](l),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function l(e){asyncGeneratorStep(i,n,a,l,o,"next",e)}function o(e){asyncGeneratorStep(i,n,a,l,o,"throw",e)}l(void 0)})}}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var getFieldUIName=function(e){var t=e.uiName;if(!t)throw new Error("ERROR: No uiName defined for field "+e);return t},getDateFieldFormat=function(e){var t=getFieldType(e);if("date"!==t)throw new Error("ERROR: Trying to get date format for non-date field, "+e);var r=e.format;if("date"===t&&!r)throw new Error("ERROR: No dateformat defined for field "+e);return r},getFieldType=function(e){return e.type},getFieldDataSource=function(e,t){var r=e.dataSource;if(r||console.warn("WARNING: No dataSource property given to the field the field "+e.uiName+"."),!r&&t)throw new Error("ERROR: property dataSource is required for field "+e.uiName);if(r&&0===r.length&&t)throw new Error("WARNING: property dataSource for field "+e.uiName+" is passed but is an empty array. ");return r},getFieldKey=function(e,t){var r=Object.keys(e).find(function(e){return e===t});if(!r)throw new Error("ERROR: No field defined with the name "+t+".");return r},discardNullUndefined=function(e){return e.has(null)&&e.delete(null),e.has(void 0)&&e.delete(void 0),e.has("")&&e.delete(""),e},generateFieldDataSourceValues=function(e,t){var r=[].concat(e.map(function(e){return e[t]})),n=new Set(r);return(n=discardNullUndefined(n)).size>0?Array.from(n):[]},operationsMap={"<":"checkIsBefore",">":"checkIsAfter",in:"checkIsBetween","==":"checkIsSame"},parser=new Parser,prepareDate=function(e,t){return fnsFormatDate(fnsParseDate(e),t)};parser.functions.checkIsBefore=function(e,t,r){return fnsIsBefore(prepareDate(e,r),prepareDate(t,r))},parser.functions.checkIsAfter=function(e,t,r){return fnsIsAfter(prepareDate(e,r),prepareDate(t,r))},parser.functions.checkIsBetween=function(e,t,r,n){return fnsIsWithinRange(prepareDate(e,n),prepareDate(t,n),prepareDate(r,n))},parser.functions.checkIsSame=function(e,t,r){return fnsIsEqual(prepareDate(e,r),prepareDate(t,r))},parser.functions.isLike=function(e,t){return e.includes(t)};var prepareFilterQuery=function(e,t){var r=t.clientFilterBy,n="( ",a=function(){if(l){if(o>=i.length)return"break";s=i[o++]}else{if((o=i.next()).done)return"break";s=o.value}var t=s,r=t[0],a=t[1];n.length>2&&(n+=" and (");var c=e.dataFields[r];if("multiselect"===getFieldType(c)){var u="";a.forEach(function(e){u.length>0&&(u+=" or "),u+="d."+r+' == "'+e+'"'}),n+=u+=" )"}else{if("autocomplete"===getFieldType(c))n+="d."+r+' == "'+a+'"';else if("simplestring"===getFieldType(c))n+="isLike(d."+r+", "+a+")";else if("number"===getFieldType(c))n+="d."+r+" "+a;else if("bool"===getFieldType(c))n+="d."+r+" == "+a;else if("date"===getFieldType(c)){var p=getDateFieldFormat(c);n+=a.includes(",")?parseDatesArray(r,a,p):parseSingleDate(r,a,p)}n+=" )"}},i=r.entries(),l=Array.isArray(i),o=0;for(i=l?i:i[Symbol.iterator]();;){var s;if("break"===a())break}return n},parseDatesArray=function(e,t,r){var n=t.split(","),a=n[0].split(" "),i=a[0],l=a[1],o=n[1];return operationsMap[i]+"(d."+e+", '"+l+"', '"+o+"', '"+r+"')"},parseSingleDate=function(e,t,r){var n=t.split(" "),a=n[0],i=n[1];return operationsMap[a]+"(d."+e+", '"+i+"', '"+r+"')"},applyFilters=function(e,t){var r=parser.parse(t).toJSFunction("d");return e.filter(function(e){return r(e)})},Search=_Input.Search,SearchAllBar=function(e){function t(t){var r;return(r=e.call(this,t)||this).innerOnSearch=function(e){r.props.onSearch(e)},r.componentDidUpdate=function(e,t,n){r.props.clearText&&!e.clearText&&(r.inputRef.current.input.input.value=null)},r.inputRef=React.createRef(),r}return _inheritsLoose(t,e),t.prototype.render=function(){return React.createElement(Search,{ref:this.inputRef,onSearch:this.innerOnSearch,placeholder:"Search..."})},t}(React.Component),Option=_Select.Option,NumberFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){"string"==typeof e?r.setState(function(t,r){return{operator:e}}):r.setState(function(t,r){return{number:e}})},r.state={operator:"==",number:null},r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props,t=e.name,r=e.min,n=e.max;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,t),React.createElement("div",{className:"filter-content"},React.createElement(_Select,{className:"operator-value",defaultValue:"==",onChange:this.handleChange},React.createElement(Option,{value:">="}," >= "),React.createElement(Option,{value:"<="}," <= "),React.createElement(Option,{value:">"}," > "),React.createElement(Option,{value:"<"}," < "," "),React.createElement(Option,{value:"=="}," = "),React.createElement(Option,{value:"!="}," != ")),React.createElement(_InputNumber,{className:"filter-value",onChange:this.handleChange,key:t,placeholder:t,min:r,max:n})))},t}(React.Component);NumberFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired,min:PropTypes.number,max:PropTypes.number};var BooleanFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){r.setState(function(t,r){return{value:e}})},r.state={value:null},r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props.name;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,e),React.createElement("div",{className:"filter-content"},React.createElement(_Select,{style:{minWidth:200,width:"100%"},allowClear:!0,key:e,onChange:this.handleChange,placeholder:e},React.createElement(_Select.Option,{key:!0},"YES"),React.createElement(_Select.Option,{key:!1},"NO"),React.createElement(_Select.Option,{key:" - "}," - "))))},t}(React.Component);BooleanFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired};var Option$1=_Select.Option,prepareDate$1=function(e,t){return fnsFormatDate(fnsParseDate(e),t)},isValidDate=function(e){return fnsIsValid(fnsParseDate(e))},DateFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){if("string"==typeof e)r.setState(function(t,r){return{operator:e,date:null}},function(){r.dateRef.current.picker.clearSelection(new Event("clearEvent"))});else{var t=[];if(Array.isArray(e))e.forEach(function(e){isValidDate(e)&&t.push(prepareDate$1(e,r.props.format))});else{if(!isValidDate(e))return;t.push(prepareDate$1(e,r.props.format))}r.setState(function(e,r){return{date:[].concat(t)}})}},r.renderDatePicker=function(){return"in"===r.state.operator?React.createElement(_DatePicker.RangePicker,{ref:r.dateRef,format:r.props.format,className:"filter-value",placeholder:["From","To"],onChange:r.handleChange}):React.createElement(_DatePicker,{ref:r.dateRef,format:r.props.format,className:"filter-value",placeholder:r.props.name,onChange:r.handleChange})},r.state={operator:"==",date:null},r.dateRef=React.createRef(),r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props.name;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,e),React.createElement("div",{className:"filter-content"},React.createElement(_Select,{className:"operator-value",defaultValue:"==",onChange:this.handleChange},React.createElement(Option$1,{value:">"}," > "),React.createElement(Option$1,{value:"<"}," < "),React.createElement(Option$1,{value:"=="}," = "),React.createElement(Option$1,{value:"in"}," in ")),this.renderDatePicker()))},t}(React.Component);DateFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired,format:PropTypes.string},DateFilter.defaultProps={format:"YYYY-MM-DD"};var StringInputFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){var t=e.target.value;r.setState(function(e,r){return{value:t}})},r.state={value:null},r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props.name;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,e),React.createElement("div",{className:"filter-content"},React.createElement(_Input,{style:{width:"100%",minWidth:200},key:e,onChange:this.handleChange,placeholder:e})))},t}(React.Component);StringInputFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired};var AutoCompleteFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){r.setState(function(t,r){return{value:e}})},r.state={value:null},r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props,t=e.name,r=e.dataSource;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,t),React.createElement("div",{className:"filter-content"},React.createElement(_AutoComplete,{ref:this.inputRef,style:{width:"100%",minWidth:200},allowClear:!0,key:t,onChange:this.handleChange,dataSource:r,placeholder:t})))},t}(React.Component);AutoCompleteFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired,dataSource:PropTypes.array};var MultiSelectFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidUpdate=function(e,t){r.props.onChange(r.state)},r.handleChange=function(e){r.setState(function(t,r){return{values:e}})},r.state={values:[]},r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props,t=e.name,r=e.dataSource;return React.createElement("div",{className:"ant-filter-container"},React.createElement("span",null,t),React.createElement("div",{className:"filter-content"},React.createElement(_Select,{style:{minWidth:200,width:"100%"},allowClear:!0,onChange:this.handleChange,mode:"multiple",key:t,placeholder:t},r)))},t}(React.Component);MultiSelectFilter.propTypes={onChange:PropTypes.func.isRequired,name:PropTypes.string.isRequired,dataSource:PropTypes.array};var Option$2=_Select.Option,buildNumberFilters=function(e,t,r,n){var a,i;if(r&&r.length>1){var l=[Math.min(r),Math.max(r)],o=l[0],s=l[1];a=isNaN(o)?-1/0:o,i=isNaN(s)?1/0:s}return React.createElement(NumberFilter,{key:"number-filter-"+e,name:getFieldUIName(t),onChange:function(t){return n(t,e)},min:a,max:i})},buildDateFilters=function(e,t,r,n){return React.createElement(DateFilter,{key:"date-filter-"+e,format:getDateFieldFormat(t),name:getFieldUIName(t),onChange:function(t){return n(t,e)}})},buildBooleanFilters=function(e,t,r,n){return React.createElement(BooleanFilter,{key:"boolean-filter-"+e,name:getFieldUIName(t),onChange:function(t){return n(t,e)}})},buildMultiSelectFilters=function(e,t,r,n){var a=r.length>0?r.map(function(e,t){return React.createElement(Option$2,{key:t}," ",e," ")}):React.createElement(Option$2,{key:e+"-empty"}," - ");return React.createElement(MultiSelectFilter,{key:"multiselect-filter-"+e,name:getFieldUIName(t),dataSource:a,onChange:function(t){return n(t,e,r)}})},buildStringInputFilters=function(e,t,r,n){return React.createElement(StringInputFilter,{key:"stringInput-filter-"+e,name:getFieldUIName(t),onChange:function(t){return n(t,e)}})},buildAutocompleteFilters=function(e,t,r,n){return React.createElement(AutoCompleteFilter,{key:"autocomplete-filter-"+e,name:getFieldUIName(t),onChange:function(t){return n(t,e)},dataSource:r})},ListFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidMount=function(){r.props.autoBuildFilters&&r.autoBuildFilterContent()},r.resetDataSource=function(){r.setState(function(e,t){return{dataSource:t.dataSource}})},r.sendFilterQuery=function(e){var t=r.state.clientFilterBy;if(t)if(0!==t.size){var n=prepareFilterQuery(r.props,r.state),a=applyFilters(r.props.dataSource,n);r.setState(function(e,t){return{dataSource:a,isFilterEnabled:!0}})}else r.resetDataSource()},r.discardExcludedFields=function(e){var t=[].concat(e),n=r.props.excludeFields;return n&&n.length>0&&(t=t.filter(function(e){return!n.includes(e)})),t},r.decideFiltersToBuild=function(){var e=r.props.dataSource,t=r.state.visibleFilters;if(t.size>0)return Array.from(t.keys());var n=Object.keys(e[0]);return r.discardExcludedFields(n)},r.autoBuildFilterContent=function(){var e=r.props,t=e.dataFields,n=e.dataSource,a=r.decideFiltersToBuild(),i=new Map;a.forEach(function(e){var a=t[e],l=getFieldDataSource(a)||generateFieldDataSourceValues(n,e);"autocomplete"===a.type&&i.set(e,buildAutocompleteFilters(e,a,l,r.setStringInputFilter)),"simplestring"===a.type&&i.set(e,buildStringInputFilters(e,a,l,r.setStringInputFilter)),"multiselect"===a.type&&i.set(e,buildMultiSelectFilters(e,a,l,r.setMultiSelectFilter)),"number"===a.type&&i.set(e,buildNumberFilters(e,a,l,r.setNumberFilter)),"bool"===a.type&&i.set(e,buildBooleanFilters(e,a,l,r.setBooleanFilter)),"date"===a.type&&i.set(e,buildDateFilters(e,a,l,r.setDateFilter))}),r.setState(function(e,t){return{filtersContent:i}})},r.manualBuildFilterContent=function(e){var t,n=r.props,a=n.dataFields,i=n.dataSource,l=a[e],o=getFieldDataSource(l)||generateFieldDataSourceValues(i,e);"autocomplete"===l.type&&(t=buildAutocompleteFilters(e,l,o,r.setStringInputFilter)),"simplestring"===l.type&&(t=buildStringInputFilters(e,l,o,r.setStringInputFilter)),"multiselect"===l.type&&(t=buildMultiSelectFilters(e,l,o,r.setMultiSelectFilter)),"number"===l.type&&(t=buildNumberFilters(e,l,o,r.setNumberFilter)),"bool"===l.type&&(t=buildBooleanFilters(e,l,o,r.setBooleanFilter)),"date"===l.type&&(t=buildDateFilters(e,l,o,r.setDateFilter));var s=r.state.filtersContent;s.has(e)?s.delete(e):s.set(e,t),r.setState(function(e,t){return{filtersContent:s}})},r.setDateFilter=function(e,t){var n=e.operator,a=e.date,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=n+" "+a;a?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setNumberFilter=function(e,t){var n=e.operator,a=e.number,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=n+" "+a;a?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setStringInputFilter=function(e,t){var n=e.value,a=r.state.clientFilterBy,i=getFieldKey(r.props.dataFields,t);n?a.set(i,n):a.delete(i),r.setState({clientFilterBy:a})},r.setMultiSelectFilter=function(e,t,n){var a=e.values,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=a.map(function(e){return n[e]});o&&0!==o.length?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setBooleanFilter=function(e,t){var n=e.value,a=r.state.clientFilterBy,i=getFieldKey(r.props.dataFields,t);n&&" - "!==n?a.set(i,n):a.delete(i),r.setState({clientFilterBy:a})},r.closeFiltersDrawer=function(){r.setState(function(e,t){return{filtersDrawerVisible:!1}})},r.toggleFilterSelection=function(e){var t=e.target,n=t.name,a=t.checked,i=r.state,l=i.visibleFilters,o=i.clientFilterBy;l.set(n,a);var s=o;s.has(n)&&s.delete(n),r.setState(function(e,t){return{visibleFilters:l,clientFilterBy:s}}),r.manualBuildFilterContent(n)},r.filterSelectionContent=function(){var e=Object.keys(r.props.dataSource[0]),t=r.discardExcludedFields(e).map(function(e){return React.createElement(_Checkbox,{name:e,key:e+"-filter-selection",checked:r.state.visibleFilters.get(e),onChange:r.toggleFilterSelection},getFieldUIName(r.props.dataFields[e]))});return React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},t)},r.clearFilters=function(e){r.setState(function(e,t){return{isFilterEnabled:!1,dataSource:t.dataSource,clientFilterBy:new Map,filtersContent:new Map}},r.autoBuildFilterContent)},r.showFiltersInDrawer=function(){var e=[],t=r.state.filtersContent.values(),n=Array.isArray(t),a=0;for(t=n?t:t[Symbol.iterator]();;){var i;if(n){if(a>=t.length)break;i=t[a++]}else{if((a=t.next()).done)break;i=a.value}var l=i;e.push(l)}return e.length>0&&e.push(r.buildSenderButton()),0===e.length&&e.push(React.createElement("p",{key:"no-items"}," No Items ")),e},r.toggleDrawerVisibility=function(e){r.setState(function(e,t){return{filtersDrawerVisible:!e.filtersDrawerVisible}})},r.onSearchAllClient=function(e){var t=[];t=0===e.length?r.props.dataSource:r.props.dataSource.filter(function(t){return Object.values(t).map(function(e){return""+e}).some(function(t){return t.toLowerCase().includes(e.toLowerCase())})}),r.setState(function(e,r){return{dataSource:t,clientFilterBy:new Map,visibleFilters:r.savedVisibleFilters||new Map,filtersContent:new Map,filtersDrawerVisible:!1,isFilterEnabled:!0}})},r.buildSenderButton=function(){return React.createElement(_Button,{key:"query-sender-button",tabIndex:"1",type:"primary",style:{marginTop:"1em"},onClick:r.sendFilterQuery},"Search")},r.state={isFilterEnabled:!1,dataSource:r.props.dataSource,clientFilterBy:new Map,visibleFilters:new Map,filtersContent:new Map,filtersDrawerVisible:!1},r.inputSearchRef=React.createRef(),r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props,t=e.autoBuildFilters,r=e.renderList,n=e.withFilterPicker;return React.createElement("div",{className:"list-filter-container"},React.createElement(_Card,{className:"list-filters"},React.createElement(_Drawer,{closable:!0,mask:!1,onClose:this.closeFiltersDrawer,visible:this.state.filtersDrawerVisible},React.createElement("div",{className:"filters-content"},this.showFiltersInDrawer())),React.createElement("div",{className:"filter-controls"},React.createElement("div",{className:"filter-controls-left"},n&&React.createElement("div",{className:"filter-picker"},React.createElement(_Tooltip,{placement:"left",title:(this.state.filtersDrawerVisible?"Hide":"Show")+" Filters"},React.createElement(_Button,{style:{margin:"0.3em"},type:"primary",shape:"circle",onClick:this.toggleDrawerVisibility},React.createElement(_Icon,{type:"filter"}))),!t&&React.createElement(_Popover,{placement:"bottom",trigger:"hover",content:this.filterSelectionContent()},React.createElement(_Tooltip,{placement:"right",title:"Available Filters"},React.createElement(_Button,{type:"circle"},React.createElement(_Icon,{type:"bars"}))))),this.state.isFilterEnabled&&React.createElement(_Button,{onClick:this.clearFilters,style:{margin:"0.3em"},type:"danger",icon:"close"},"Clear")),React.createElement("div",{className:"filter-controls-right"},React.createElement(SearchAllBar,{clearText:!this.state.isFilterEnabled,onSearch:this.onSearchAllClient})))),r(this.state.dataSource))},t}(React.Component);ListFilter.propTypes={dataFields:PropTypes.objectOf(PropTypes.shape({type:PropTypes.oneOf(["simplestring","autocomplete","multiselect","number","date","bool"]).isRequired,uiName:PropTypes.string.isRequired,format:PropTypes.string,dataSource:PropTypes.array,nullValue:PropTypes.any})).isRequired,savedVisibleFilters:PropTypes.array,dataSource:PropTypes.arrayOf(Object).isRequired,autoBuildFilters:PropTypes.bool,renderList:PropTypes.func.isRequired,excludeFields:PropTypes.arrayOf(PropTypes.string),withFilterPicker:PropTypes.bool},ListFilter.defaultProps={withFilterPicker:!0,autoBuildFilters:!1};var ServerFilter=function(e){function t(t){var r;return(r=e.call(this,t)||this).componentDidMount=function(){r.props.autoBuildFilters&&r.autoBuildFilterContent()},r.resetDataSource=function(){r.setState(function(e,t){return{dataSource:t.dataSource}})},r.mapFiltersToServer=function(){var e=[],t=r.state.clientFilterBy,n=Array.isArray(t),a=0;for(t=n?t:t[Symbol.iterator]();;){var i;if(n){if(a>=t.length)break;i=t[a++]}else{if((a=t.next()).done)break;i=a.value}var l=i,o=l[0],s=l[1],c=r.props.dataFields[o],u={Name:o,Type:getFieldType(c),Values:Array.isArray(s)?s:[s]};e.push(u)}return e},r.discardExcludedFields=function(e){var t=[].concat(e),n=r.props.excludeFields;return n&&n.length>0&&(t=t.filter(function(e){return!n.includes(e)})),t},r.decideFiltersToBuild=function(){var e=r.props.dataSource,t=r.state.visibleFilters;if(t.size>0)return Array.from(t.keys());var n=Object.keys(e[0]);return r.discardExcludedFields(n)},r.autoBuildFilterContent=function(){var e=r.props.dataFields,t=r.decideFiltersToBuild(),n=new Map;t.forEach(function(t){var a=e[t],i=getFieldDataSource(e[t]);"autocomplete"===a.type&&n.set(t,buildAutocompleteFilters(t,a,i,r.setStringInputFilter)),"simplestring"===a.type&&n.set(t,buildStringInputFilters(t,a,i,r.setStringInputFilter)),"multiselect"===a.type&&n.set(t,buildMultiSelectFilters(t,a,i,r.setMultiSelectFilter)),"number"===a.type&&n.set(t,buildNumberFilters(t,a,i,r.setNumberFilter)),"bool"===a.type&&n.set(t,buildBooleanFilters(t,a,i,r.setBooleanFilter)),"date"===a.type&&n.set(t,buildDateFilters(t,a,i,r.setDateFilter))}),r.setState(function(e,t){return{filtersContent:n}})},r.manualBuildFilterContent=function(e){var t,n=r.props.dataFields[e];if("autocomplete"===n.type){var a=getFieldDataSource(n,!0);t=buildAutocompleteFilters(e,n,a,r.setStringInputFilter)}if("simplestring"===n.type){var i=getFieldDataSource(n,!1);t=buildStringInputFilters(e,n,i,r.setStringInputFilter)}if("multiselect"===n.type){var l=getFieldDataSource(n,!0);t=buildMultiSelectFilters(e,n,l,r.setMultiSelectFilter)}if("number"===n.type){var o=getFieldDataSource(n,!1);t=buildNumberFilters(e,n,o,r.setNumberFilter)}if("bool"===n.type){var s=getFieldDataSource(n,!1);t=buildBooleanFilters(e,n,s,r.setBooleanFilter)}if("date"===n.type){var c=getFieldDataSource(n,!1);t=buildDateFilters(e,n,c,r.setDateFilter)}var u=r.state.filtersContent;u.has(e)?u.delete(e):u.set(e,t),r.setState(function(e,t){return{filtersContent:u}})},r.setDateFilter=function(e,t){var n=e.operator,a=e.date,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=n+" "+a;a?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setNumberFilter=function(e,t){var n=e.operator,a=e.number,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=n+" "+a;a?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setStringInputFilter=function(e,t){var n=e.value,a=r.state.clientFilterBy,i=getFieldKey(r.props.dataFields,t);n?a.set(i,n):a.delete(i),r.setState({clientFilterBy:a})},r.setMultiSelectFilter=function(e,t,n){var a=e.values,i=r.state.clientFilterBy,l=getFieldKey(r.props.dataFields,t),o=a.map(function(e){return n[e]});o&&0!==o.length?i.set(l,o):i.delete(l),r.setState({clientFilterBy:i})},r.setBooleanFilter=function(e,t){var n=e.value,a=r.state.clientFilterBy,i=getFieldKey(r.props.dataFields,t);n&&" - "!==n?a.set(i,n):a.delete(i),r.setState({clientFilterBy:a})},r.closeFiltersDrawer=function(){r.setState(function(e,t){return{filtersDrawerVisible:!1}})},r.toggleFilterSelection=function(e){var t=e.target,n=t.name,a=t.checked,i=r.state,l=i.visibleFilters,o=i.clientFilterBy;l.set(n,a);var s=o;s.has(n)&&s.delete(n),r.setState(function(e,t){return{visibleFilters:l,clientFilterBy:s}}),r.manualBuildFilterContent(n)},r.filterSelectionContent=function(){var e=Object.keys(r.props.dataSource[0]),t=r.discardExcludedFields(e).map(function(e){return React.createElement(_Checkbox,{name:e,key:e+"-filter-selection",checked:r.state.visibleFilters.get(e),onChange:r.toggleFilterSelection},getFieldUIName(r.props.dataFields[e]))});return React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},t)},r.clearFilters=function(e){r.setState(function(e,t){return{isFilterEnabled:!1,dataSource:t.dataSource,ServerFilterBy:[],FilteredData:[],clientFilterBy:new Map,filtersContent:new Map}},r.autoBuildFilterContent)},r.showFiltersInDrawer=function(){var e=[],t=r.state.filtersContent.values(),n=Array.isArray(t),a=0;for(t=n?t:t[Symbol.iterator]();;){var i;if(n){if(a>=t.length)break;i=t[a++]}else{if((a=t.next()).done)break;i=a.value}var l=i;e.push(l)}return e.length>0&&e.push(r.buildSenderButton()),0===e.length&&e.push(React.createElement("p",{key:"no-items"}," No Items ")),e},r.toggleDrawerVisibility=function(e){r.setState(function(e,t){return{filtersDrawerVisible:!e.filtersDrawerVisible}})},r.onSearchAllServer=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[{Name:"ALL",Type:null,Values:[t.toLowerCase()]}],r.setState(function(e,t){return{ServerFilterBy:n,visibleFilters:t.savedVisibleFilters||new Map,filtersContent:new Map,filtersDrawerVisible:!1,isFilterEnabled:!0,isSearching:!0}}),e.next=4,r.props.onPostFilters(n);case 4:a=e.sent,r.setState(function(e,t){return{FilteredData:a,isSearching:!1}});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r.buildSenderButton=function(){return React.createElement(_Button,{tabIndex:"1",key:"query-sender-button",loading:r.state.isSearching,type:"primary",style:{marginTop:"1em"},onClick:r.handleServerFiltering},"Search")},r.handleServerFiltering=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.mapFiltersToServer(),r.setState(function(e,t){return{ServerFilterBy:n,isFilterEnabled:!0,isSearching:!0}}),e.next=4,r.props.onPostFilters(n);case 4:a=e.sent,r.setState({FilteredData:a,isSearching:!1});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r.renderListComponent=function(e){var t=r.state,n=t.ServerFilterBy,a=t.isSearching,i=t.dataSource,l=t.FilteredData;return n.length>0?a?e(i,!0):e(l,!1):e(i,!1)},r.state={isSearching:!1,isFilterEnabled:!1,dataSource:r.props.dataSource,clientFilterBy:new Map,ServerFilterBy:[],FilteredData:[],visibleFilters:new Map,filtersContent:new Map,filtersDrawerVisible:!1},r.inputSearchRef=React.createRef(),r}return _inheritsLoose(t,e),t.prototype.render=function(){var e=this.props,t=e.autoBuildFilters,r=e.renderList,n=e.withFilterPicker;return React.createElement("div",{className:"list-filter-container"},React.createElement(_Card,{className:"list-filters"},React.createElement(_Drawer,{closable:!0,mask:!1,onClose:this.closeFiltersDrawer,visible:this.state.filtersDrawerVisible},React.createElement("div",{className:"filters-content"},this.showFiltersInDrawer())),React.createElement("div",{className:"filter-controls"},React.createElement("div",{className:"filter-controls-left"},n&&React.createElement("div",{className:"filter-picker"},React.createElement(_Tooltip,{placement:"left",title:(this.state.filtersDrawerVisible?"Hide":"Show")+" Filters"},React.createElement(_Button,{style:{margin:"0.3em"},type:"primary",shape:"circle",onClick:this.toggleDrawerVisibility},React.createElement(_Icon,{type:"filter"}))),!t&&React.createElement(_Popover,{placement:"bottom",trigger:"hover",content:this.filterSelectionContent()},React.createElement(_Tooltip,{placement:"right",title:"Available Filters"},React.createElement(_Button,{type:"circle"},React.createElement(_Icon,{type:"bars"}))))),this.state.isFilterEnabled&&React.createElement(_Button,{onClick:this.clearFilters,style:{margin:"0.3em"},type:"danger",icon:"close"},"Clear")),React.createElement("div",{className:"filter-controls-right"},React.createElement(SearchAllBar,{clearText:this.state.isFilterEnabled&&this.state.ServerFilterBy[0]&&"ALL"!==this.state.ServerFilterBy[0].Name,onSearch:this.onSearchAllServer})))),this.renderListComponent(r))},t}(React.Component);ServerFilter.propTypes={dataFields:PropTypes.objectOf(PropTypes.shape({type:PropTypes.oneOf(["simplestring","autocomplete","multiselect","number","date","bool"]).isRequired,uiName:PropTypes.string.isRequired,format:PropTypes.string,dataSource:PropTypes.array.isRequired,nullValue:PropTypes.any}).isRequired).isRequired,savedVisibleFilters:PropTypes.array,dataSource:PropTypes.arrayOf(PropTypes.object).isRequired,autoBuildFilters:PropTypes.bool,onPostFilters:PropTypes.func.isRequired,renderList:PropTypes.func.isRequired,customStyles:PropTypes.objectOf(PropTypes.object),excludeFields:PropTypes.arrayOf(PropTypes.string),withFilterPicker:PropTypes.bool},ServerFilter.defaultProps={withFilterPicker:!0,autoBuildFilters:!1};var ClientFilter=ListFilter,ServerFilter$1=ServerFilter,index$5={ClientFilter:ListFilter,ServerFilter:ServerFilter};export default index$5;export{ClientFilter,ServerFilter$1 as ServerFilter};
